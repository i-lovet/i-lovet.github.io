---
标题: 玄尊查询记录
aliases:
  - 查询记录
tags:
  - 玄尊/数据库
创建时间: 2025-07-18 12:07
修改时间: 2025-08-06 21:22
dg-publish: true
---
### 1、查询检测记录 行转列

```sql
select aaa.*,
	sc.`name` as '姓名', 
	-- sc.mobile as '手机号',
	case sc.sex when 0 then '女' when 1 then '男' else '' end as '性别',
	FROM_UNIXTIME(sc.birthday/1000,'%Y-%m-%d') as '出生年月日',
	concat('https://oss.aimyskin.com/', sc.head_img) as '头像' 
from 
(
	select sfd.id, sfd.device_id, sfd.consumer_id, sfd.skin_age, 
		sfd.total_score, sfd.type, sfd.create_time,
		max(case ttt.img_type_id when 21 then ttt.predicted 
			else null end ) '皱纹',
		max(case ttt.img_type_id when 22 then ttt.predicted 
			else null end ) '毛孔',
		max(case ttt.img_type_id when 23 then ttt.predicted 
			else null end ) '色斑',
		max(case ttt.img_type_id when 25 then ttt.predicted 
			else null end ) '油性',
		max(case ttt.img_type_id when 26 then ttt.predicted 
			else null end ) '敏感'
	from 
	(
		select * from sms_face_detection_info where predicted is not null 		
			and img_type_id in (21,22,23,25,26)
			and face_detection_id in (
				select tt.id from (select id from sms_face_detection 
				ORDER BY create_time desc  LIMIT 1000 ) as tt
			)
		) as ttt 
		left join sms_face_detection sfd on sfd.id = ttt.face_detection_id
		-- left join sms_consumer sc on sc.id = sfd.consumer_id
		GROUP BY ttt.face_detection_id
) aaa
left join sms_consumer sc on aaa.consumer_id = sc.id

------------
select 
	sc.`name` as '姓名', 
	-- sc.mobile as '手机号',
	case sc.sex when 0 then '女' when 1 then '男' else '' end as '性别',
	FROM_UNIXTIME(sc.birthday/1000,'%Y-%m-%d') as '出生年月日',
	concat('https://oss.aimyskin.com/', sc.head_img) as '头像',
	aaa.* 
from 
(
	select sfd.id, sfd.skin_age, 
		-- sfd.device_id, 
		sfd.consumer_id, 
		sfd.total_score, sfd.type, 
		-- sfd.create_time, 
		
		max(case ttt.img_type_id when 21 then ttt.feature_count 
			else null end ) '皱纹-feature_count',
		max(case ttt.img_type_id when 22 then ttt.feature_count 
			else null end ) '毛孔-feature_count',
		max(case ttt.img_type_id when 23 then ttt.feature_count 
			else null end ) '色斑-feature_count',
		max(case ttt.img_type_id when 25 then ttt.feature_count 
			else null end ) '油性-feature_count',
		max(case ttt.img_type_id when 26 then ttt.feature_count 
			else null end ) '敏感-feature_count',
		
		max(case ttt.img_type_id when 21 then ttt.predicted 
			else null end ) '皱纹',
		max(case ttt.img_type_id when 22 then ttt.predicted 
			else null end ) '毛孔',
		max(case ttt.img_type_id when 23 then ttt.predicted 
			else null end ) '色斑',
		max(case ttt.img_type_id when 25 then ttt.predicted 
			else null end ) '油性',
		max(case ttt.img_type_id when 26 then ttt.predicted 
			else null end ) '敏感',
			
		max(case ttt.img_type_id when 21 then concat('https://oss.aimyskin.com/', ttt.img_url) 
			else null end ) '皱纹图片',
		max(case ttt.img_type_id when 22 then concat('https://oss.aimyskin.com/', ttt.img_url) 
			else null end ) '毛孔图片',
		max(case ttt.img_type_id when 23 then concat('https://oss.aimyskin.com/', ttt.img_url) 
			else null end ) '色斑图片',
		max(case ttt.img_type_id when 25 then concat('https://oss.aimyskin.com/', ttt.img_url) 
			else null end ) '油性图片',
		max(case ttt.img_type_id when 26 then concat('https://oss.aimyskin.com/', ttt.img_url) 
			else null end ) '敏感图片'	
			
	from 
	(
		select * from sms_face_detection_info where predicted is not null 		
			and img_type_id in (21,22,23,25,26)
			and face_detection_id in (
				select tt.id from (select id from sms_face_detection 
				ORDER BY create_time desc  LIMIT 1000 ) as tt
			)
	) as ttt 
	left join sms_face_detection sfd on sfd.id = ttt.face_detection_id
	-- left join sms_consumer sc on sc.id = sfd.consumer_id
	GROUP BY ttt.face_detection_id
) aaa
left join sms_consumer sc on aaa.consumer_id = sc.id

```

### 2、查询检测过的用户

```sql
select * from ums_user where email IN ('tadawsaparapharmacie@gmail.com', 'paranou.para@gmail.com ');
select * from pms_device where id IN ('6FA0D699873D', '13DC2F5A83B7')

select * from ums_store where user_id IN (
	select id from ums_user where email IN ('tadawsaparapharmacie@gmail.com', 'paranou.para@gmail.com ')
)

select * from ums_store where id IN (
	select store_id from pms_device where id IN ('6FA0D699873D', '13DC2F5A83B7')
)

select *, FROM_UNIXTIME(birthday) from sms_consumer where id IN (
	select consumer_id from sms_face_detection where device_id in ('13DC2F5A83B7')
);

-- 6FA0D699873D-tadawsaparapharmacie@gmail.com 1904514274770604033 463 6FA0D699873D
-- 13DC2F5A83B7-paranou.para@gmail.com         1916868025611243522 508 13DC2F5A83B7

```

### 3、iPad 型号汇总查询
  [SQL记录](../../../02.Area/技术/MySQL/SQL记录.md)
