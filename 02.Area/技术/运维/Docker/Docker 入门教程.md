---
æ ‡é¢˜: Docker å…¥é—¨æ•™ç¨‹
aliases: 
tags:
  - æŠ€æœ¯/Docker
åˆ›å»ºæ—¶é—´: 2025-07-24 19:17
ä¿®æ”¹æ—¶é—´: 2025-08-06 21:59
---
## ä¸€ã€ç¯å¢ƒé…ç½®çš„éš¾é¢˜

è½¯ä»¶å¼€å‘æœ€å¤§çš„éº»çƒ¦äº‹ä¹‹ä¸€ï¼Œå°±æ˜¯ç¯å¢ƒé…ç½®ã€‚ç”¨æˆ·è®¡ç®—æœºçš„ç¯å¢ƒéƒ½ä¸ç›¸åŒï¼Œä½ æ€ä¹ˆçŸ¥é“è‡ªå®¶çš„è½¯ä»¶ï¼Œèƒ½åœ¨é‚£äº›æœºå™¨è·‘èµ·æ¥ï¼Ÿ

ç”¨æˆ·å¿…é¡»ä¿è¯ä¸¤ä»¶äº‹ï¼šæ“ä½œç³»ç»Ÿçš„è®¾ç½®ï¼Œå„ç§åº“å’Œç»„ä»¶çš„å®‰è£…ã€‚åªæœ‰å®ƒä»¬éƒ½æ­£ç¡®ï¼Œè½¯ä»¶æ‰èƒ½è¿è¡Œã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå®‰è£…ä¸€ä¸ª Python åº”ç”¨ï¼Œè®¡ç®—æœºå¿…é¡»æœ‰ Python å¼•æ“ï¼Œè¿˜å¿…é¡»æœ‰å„ç§ä¾èµ–ï¼Œå¯èƒ½è¿˜è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚

å¦‚æœæŸäº›è€æ—§çš„æ¨¡å—ä¸å½“å‰ç¯å¢ƒä¸å…¼å®¹ï¼Œé‚£å°±éº»çƒ¦äº†ã€‚å¼€å‘è€…å¸¸å¸¸ä¼šè¯´ï¼š"å®ƒåœ¨æˆ‘çš„æœºå™¨å¯ä»¥è·‘äº†"ï¼ˆIt works on my machineï¼‰ï¼Œè¨€ä¸‹ä¹‹æ„å°±æ˜¯ï¼Œå…¶ä»–æœºå™¨å¾ˆå¯èƒ½è·‘ä¸äº†ã€‚

ç¯å¢ƒé…ç½®å¦‚æ­¤éº»çƒ¦ï¼Œæ¢ä¸€å°æœºå™¨ï¼Œå°±è¦é‡æ¥ä¸€æ¬¡ï¼Œæ—·æ—¥è´¹æ—¶ã€‚å¾ˆå¤šäººæƒ³åˆ°ï¼Œèƒ½ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼Œè½¯ä»¶å¯ä»¥å¸¦ç¯å¢ƒå®‰è£…ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œå®‰è£…çš„æ—¶å€™ï¼ŒæŠŠåŸå§‹ç¯å¢ƒä¸€æ¨¡ä¸€æ ·åœ°å¤åˆ¶è¿‡æ¥ã€‚

## äºŒã€è™šæ‹Ÿæœº

è™šæ‹Ÿæœºï¼ˆvirtual machineï¼‰å°±æ˜¯å¸¦ç¯å¢ƒå®‰è£…çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚å®ƒå¯ä»¥åœ¨ä¸€ç§æ“ä½œç³»ç»Ÿé‡Œé¢è¿è¡Œå¦ä¸€ç§æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨ Windows ç³»ç»Ÿé‡Œé¢è¿è¡Œ Linux ç³»ç»Ÿã€‚åº”ç”¨ç¨‹åºå¯¹æ­¤æ¯«æ— æ„ŸçŸ¥ï¼Œå› ä¸ºè™šæ‹Ÿæœºçœ‹ä¸Šå»è·ŸçœŸå®ç³»ç»Ÿä¸€æ¨¡ä¸€æ ·ï¼Œè€Œå¯¹äºåº•å±‚ç³»ç»Ÿæ¥è¯´ï¼Œè™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œä¸éœ€è¦äº†å°±åˆ æ‰ï¼Œå¯¹å…¶ä»–éƒ¨åˆ†æ¯«æ— å½±å“ã€‚

è™½ç„¶ç”¨æˆ·å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºè¿˜åŸè½¯ä»¶çš„åŸå§‹ç¯å¢ƒã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ‰å‡ ä¸ªç¼ºç‚¹ã€‚

**ï¼ˆ1ï¼‰èµ„æºå ç”¨å¤š**
è™šæ‹Ÿæœºä¼šç‹¬å ä¸€éƒ¨åˆ†å†…å­˜å’Œç¡¬ç›˜ç©ºé—´ã€‚å®ƒè¿è¡Œçš„æ—¶å€™ï¼Œå…¶ä»–ç¨‹åºå°±ä¸èƒ½ä½¿ç”¨è¿™äº›èµ„æºäº†ã€‚å“ªæ€•è™šæ‹Ÿæœºé‡Œé¢çš„åº”ç”¨ç¨‹åºï¼ŒçœŸæ­£ä½¿ç”¨çš„å†…å­˜åªæœ‰ 1MBï¼Œè™šæ‹Ÿæœºä¾ç„¶éœ€è¦å‡ ç™¾ MB çš„å†…å­˜æ‰èƒ½è¿è¡Œã€‚

**ï¼ˆ2ï¼‰å†—ä½™æ­¥éª¤å¤š**
è™šæ‹Ÿæœºæ˜¯å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œä¸€äº›ç³»ç»Ÿçº§åˆ«çš„æ“ä½œæ­¥éª¤ï¼Œå¾€å¾€æ— æ³•è·³è¿‡ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•ã€‚

**ï¼ˆ3ï¼‰å¯åŠ¨æ…¢**
å¯åŠ¨æ“ä½œç³»ç»Ÿéœ€è¦å¤šä¹…ï¼Œå¯åŠ¨è™šæ‹Ÿæœºå°±éœ€è¦å¤šä¹…ã€‚å¯èƒ½è¦ç­‰å‡ åˆ†é’Ÿï¼Œåº”ç”¨ç¨‹åºæ‰èƒ½çœŸæ­£è¿è¡Œã€‚

## ä¸‰ã€Linux å®¹å™¨

ç”±äºè™šæ‹Ÿæœºå­˜åœ¨è¿™äº›ç¼ºç‚¹ï¼ŒLinux å‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼šLinux å®¹å™¨ï¼ˆLinux Containersï¼Œç¼©å†™ä¸º LXCï¼‰ã€‚

**Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚** æˆ–è€…è¯´ï¼Œåœ¨æ­£å¸¸è¿›ç¨‹çš„å¤–é¢å¥—äº†ä¸€ä¸ª[ä¿æŠ¤å±‚](https://opensource.com/article/18/1/history-low-level-container-runtimes)ã€‚å¯¹äºå®¹å™¨é‡Œé¢çš„è¿›ç¨‹æ¥è¯´ï¼Œå®ƒæ¥è§¦åˆ°çš„å„ç§èµ„æºéƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œä»è€Œå®ç°ä¸åº•å±‚ç³»ç»Ÿçš„éš”ç¦»ã€‚

ç”±äºå®¹å™¨æ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œç›¸æ¯”è™šæ‹Ÿæœºæœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚

**ï¼ˆ1ï¼‰å¯åŠ¨å¿«**
å®¹å™¨é‡Œé¢çš„åº”ç”¨ï¼Œç›´æ¥å°±æ˜¯åº•å±‚ç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºå†…éƒ¨çš„è¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œå¯åŠ¨å®¹å™¨ç›¸å½“äºå¯åŠ¨æœ¬æœºçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸æ˜¯å¯åŠ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œé€Ÿåº¦å°±å¿«å¾ˆå¤šã€‚

**ï¼ˆ2ï¼‰èµ„æºå ç”¨å°‘**
å®¹å™¨åªå ç”¨éœ€è¦çš„èµ„æºï¼Œä¸å ç”¨é‚£äº›æ²¡æœ‰ç”¨åˆ°çš„èµ„æºï¼›è™šæ‹Ÿæœºç”±äºæ˜¯å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œä¸å¯é¿å…è¦å ç”¨æ‰€æœ‰èµ„æºã€‚å¦å¤–ï¼Œå¤šä¸ªå®¹å™¨å¯ä»¥å…±äº«èµ„æºï¼Œè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬äº«èµ„æºã€‚

**ï¼ˆ3ï¼‰ä½“ç§¯å°**
å®¹å™¨åªè¦åŒ…å«ç”¨åˆ°çš„ç»„ä»¶å³å¯ï¼Œè€Œè™šæ‹Ÿæœºæ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„æ‰“åŒ…ï¼Œæ‰€ä»¥å®¹å™¨æ–‡ä»¶æ¯”è™šæ‹Ÿæœºæ–‡ä»¶è¦å°å¾ˆå¤šã€‚

æ€»ä¹‹ï¼Œå®¹å™¨æœ‰ç‚¹åƒè½»é‡çº§çš„è™šæ‹Ÿæœºï¼Œèƒ½å¤Ÿæä¾›è™šæ‹ŸåŒ–çš„ç¯å¢ƒï¼Œä½†æ˜¯æˆæœ¬å¼€é”€å°å¾—å¤šã€‚

## å››ã€Docker æ˜¯ä»€ä¹ˆï¼Ÿ

**[Docker](https://www.docker.com/) å±äº Linux å®¹å™¨çš„ä¸€ç§å°è£…ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„å®¹å™¨ä½¿ç”¨æ¥å£ã€‚** å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Linux å®¹å™¨è§£å†³æ–¹æ¡ˆã€‚
#### 4.1 Docker æ ¸å¿ƒæ¦‚å¿µ

> æ ¸å¿ƒæ¦‚å¿µ
- **å®¹å™¨ï¼ˆContainerï¼‰ï¼š** è½»é‡åŒ–çš„è¿è¡Œå®ä¾‹ï¼ŒåŒ…å«åº”ç”¨ä»£ç ã€è¿è¡Œæ—¶ç¯å¢ƒå’Œä¾èµ–åº“ã€‚åŸºäºé•œåƒåˆ›å»ºï¼Œä¸å…¶ä»–å®¹å™¨éš”ç¦»ï¼Œå…±äº«ä¸»æœºæ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆæ¯”è™šæ‹Ÿæœºæ›´é«˜æ•ˆï¼‰ã€‚
- **é•œåƒï¼ˆImageï¼‰ï¼š** åªè¯»æ¨¡æ¿ï¼Œå®šä¹‰äº†å®¹å™¨çš„è¿è¡Œç¯å¢ƒï¼ˆå¦‚æ“ä½œç³»ç»Ÿã€è½¯ä»¶é…ç½®ç­‰ï¼‰ã€‚é€šè¿‡åˆ†å±‚å­˜å‚¨ï¼ˆLayerï¼‰ä¼˜åŒ–ç©ºé—´å’Œæ„å»ºé€Ÿåº¦ã€‚
- **Dockerfileï¼š** æ–‡æœ¬æ–‡ä»¶ï¼Œæè¿°å¦‚ä½•è‡ªåŠ¨æ„å»ºé•œåƒï¼ˆä¾‹å¦‚æŒ‡å®šåŸºç¡€é•œåƒã€å®‰è£…è½¯ä»¶ã€å¤åˆ¶æ–‡ä»¶ç­‰ï¼‰ã€‚
- **ä»“åº“ï¼ˆRegistryï¼‰ï¼š** å­˜å‚¨å’Œåˆ†å‘é•œåƒçš„å¹³å°ï¼Œå¦‚ Docker Hubï¼ˆå®˜æ–¹å…¬å…±ä»“åº“ï¼‰æˆ–ç§æœ‰ä»“åº“ï¼ˆå¦‚ Harborï¼‰ã€‚

#### 4.2 Docker çš„ä¼˜åŠ¿

Docker æä¾›äº†å¿«é€Ÿå¯åŠ¨ã€èµ„æºå ç”¨å°‘ã€æ˜“äºè¿ç§»å’Œé«˜æ•ˆç®¡ç†çš„ç‰¹ç‚¹ã€‚ä¸ä¼ ç»Ÿè™šæ‹Ÿæœºç›¸æ¯”ï¼ŒDocker å®¹å™¨ä¸éœ€è¦å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå¯åŠ¨é€Ÿåº¦æ›´å¿«ï¼Œèµ„æºåˆ©ç”¨ç‡æ›´é«˜ã€‚æ­¤å¤–ï¼Œå®¹å™¨çš„åˆ†å±‚å­˜å‚¨æœºåˆ¶ä½¿å¾—é•œåƒçš„å¤ç”¨å’Œå®šåˆ¶æ›´åŠ çµæ´»ã€‚

 > æ ¸å¿ƒä¼˜åŠ¿
- **è·¨å¹³å°ä¸€è‡´æ€§ï¼š** è§£å†³"åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„é—®é¢˜ï¼Œç¡®ä¿å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸€è‡´ã€‚
- **èµ„æºé«˜æ•ˆï¼š** å®¹å™¨ç›´æ¥å…±äº«ä¸»æœºå†…æ ¸ï¼Œæ— éœ€è™šæ‹ŸåŒ–æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼ŒèŠ‚çœå†…å­˜å’Œ CPUã€‚
- **å¿«é€Ÿéƒ¨ç½²ï¼š** ç§’çº§å¯åŠ¨å®¹å™¨ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–æ‰©ç¼©å®¹ã€‚
- **éš”ç¦»æ€§ï¼š** æ¯ä¸ªå®¹å™¨æ‹¥æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå’Œè¿›ç¨‹ç©ºé—´ã€‚

## äº”ã€Docker çš„ç”¨é€”

- **å¾®æœåŠ¡æ¶æ„ï¼š** æ¯ä¸ªæœåŠ¡ç‹¬ç«‹å®¹å™¨åŒ–ï¼Œä¾¿äºç®¡ç†å’Œæ‰©å±•ã€‚
- **CI/CDæµæ°´çº¿ï¼š** ä¸ Jenkins/GitLab CI é›†æˆï¼Œå®ç°è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•ã€‚
- **å¼€å‘ç¯å¢ƒæ ‡å‡†åŒ–ï¼š** æ–°æˆå‘˜ä¸€é”®å¯åŠ¨å…¨å¥—ä¾èµ–æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€‚
- **äº‘åŸç”ŸåŸºç¡€ï¼š** Kubernetes ç­‰ç¼–æ’å·¥å…·åŸºäº Docker ç®¡ç†å®¹å™¨é›†ç¾¤ã€‚
- æä¾›ä¸€è‡´çš„å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼Œé¿å…â€œåœ¨æˆ‘çš„æœºå™¨ä¸Šå¯ä»¥è¿è¡Œâ€çš„é—®é¢˜ã€‚
- æ”¯æŒå¼¹æ€§äº‘æœåŠ¡ï¼Œå®¹å™¨å¯ä»¥å¿«é€Ÿæ‰©å±•æˆ–ç¼©å‡ã€‚
- æ„å»ºå¾®æœåŠ¡æ¶æ„ï¼Œé€šè¿‡å¤šä¸ªå®¹å™¨åœ¨å•å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ªæœåŠ¡ã€‚

## å…­ã€Docker çš„å®‰è£…

Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å•†ä¸šäº§å“ï¼Œæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šç¤¾åŒºç‰ˆï¼ˆCommunity Editionï¼Œç¼©å†™ä¸º CEï¼‰å’Œä¼ä¸šç‰ˆï¼ˆEnterprise Editionï¼Œç¼©å†™ä¸º EEï¼‰ã€‚ä¼ä¸šç‰ˆåŒ…å«äº†ä¸€äº›æ”¶è´¹æœåŠ¡ï¼Œä¸ªäººå¼€å‘è€…ä¸€èˆ¬ç”¨ä¸åˆ°ã€‚ä¸‹é¢çš„ä»‹ç»éƒ½é’ˆå¯¹ç¤¾åŒºç‰ˆã€‚

6.1 Docker CE çš„å®‰è£…å®˜æ–¹æ–‡æ¡£
  - [Mac](https://docs.docker.com/docker-for-mac/install/)
  - [Windows](https://docs.docker.com/docker-for-windows/install/)
  - [Ubuntu](https://docs.docker.com/install/linux/docker-ce/ubuntu/)
  - [Debian](https://docs.docker.com/install/linux/docker-ce/debian/)
  - [CentOS](https://docs.docker.com/install/linux/docker-ce/centos/)
  - [Fedora](https://docs.docker.com/install/linux/docker-ce/fedora/)
  - [å…¶ä»– Linux å‘è¡Œç‰ˆ](https://docs.docker.com/install/linux/docker-ce/binaries/)

å®‰è£…å®Œæˆåï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒéªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸã€‚

```bash
$ docker version
# æˆ–è€…
$ docker info
```

Docker æ˜¯æœåŠ¡å™¨----å®¢æˆ·ç«¯æ¶æ„ã€‚å‘½ä»¤è¡Œè¿è¡Œ`docker`å‘½ä»¤çš„æ—¶å€™ï¼Œéœ€è¦æœ¬æœºæœ‰ Docker æœåŠ¡ã€‚å¦‚æœè¿™é¡¹æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ï¼ˆ[å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/config/daemon/systemd/)ï¼‰ã€‚

```bash
# service å‘½ä»¤çš„ç”¨æ³•
$ sudo service docker start
# systemctl å‘½ä»¤çš„ç”¨æ³•
$ sudo systemctl start docker
```

#### 6.2 å¸¸è§çš„ Docker æ“ä½œ

``` shell
# æ‹‰å–é•œåƒï¼ˆå¦‚å®˜æ–¹Nginxé•œåƒï¼‰
docker pull nginx
# æŸ¥çœ‹æœ¬åœ°é•œåƒ
docker images
# æ„å»ºé•œåƒï¼ˆåŸºäºå½“å‰ç›®å½•çš„Dockerfileï¼‰
docker build -t my-app .

# è¿è¡Œå®¹å™¨ï¼ˆ-d åå°è¿è¡Œï¼Œ-p æ˜ å°„ç«¯å£ï¼‰
docker run -d -p 80:80 nginx
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# è¿›å…¥å®¹å™¨å†…éƒ¨
docker exec -it <å®¹å™¨ID> /bin/bash
# åœæ­¢å®¹å™¨
docker stop <container_id>
# åˆ é™¤å®¹å™¨
dockerÂ rmÂ <container_id>
```

## ä¸ƒã€image æ–‡ä»¶

**Docker æŠŠåº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ image æ–‡ä»¶é‡Œé¢ã€‚** åªæœ‰é€šè¿‡è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰èƒ½ç”Ÿæˆ Docker å®¹å™¨ã€‚image æ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯å®¹å™¨çš„æ¨¡æ¿ã€‚Docker æ ¹æ® image æ–‡ä»¶ç”Ÿæˆå®¹å™¨çš„å®ä¾‹ã€‚åŒä¸€ä¸ª image æ–‡ä»¶ï¼Œå¯ä»¥ç”Ÿæˆå¤šä¸ªåŒæ—¶è¿è¡Œçš„å®¹å™¨å®ä¾‹ã€‚

image æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®é™…å¼€å‘ä¸­ï¼Œä¸€ä¸ª image æ–‡ä»¶å¾€å¾€é€šè¿‡ç»§æ‰¿å¦ä¸€ä¸ª image æ–‡ä»¶ï¼ŒåŠ ä¸Šä¸€äº›ä¸ªæ€§åŒ–è®¾ç½®è€Œç”Ÿæˆã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä½ å¯ä»¥åœ¨ Ubuntu çš„ image åŸºç¡€ä¸Šï¼Œå¾€é‡Œé¢åŠ å…¥ Apache æœåŠ¡å™¨ï¼Œå½¢æˆä½ çš„ imageã€‚

```bash
# åˆ—å‡ºæœ¬æœºçš„æ‰€æœ‰ image æ–‡ä»¶
$ docker image ls
# åˆ é™¤ image æ–‡ä»¶
$ docker image rm [imageName]
```

image æ–‡ä»¶æ˜¯é€šç”¨çš„ï¼Œä¸€å°æœºå™¨çš„ image æ–‡ä»¶æ‹·è´åˆ°å¦ä¸€å°æœºå™¨ï¼Œç…§æ ·å¯ä»¥ä½¿ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨åˆ«äººåˆ¶ä½œå¥½çš„ image æ–‡ä»¶ï¼Œè€Œä¸æ˜¯è‡ªå·±åˆ¶ä½œã€‚å³ä½¿è¦å®šåˆ¶ï¼Œä¹Ÿåº”è¯¥åŸºäºåˆ«äººçš„ image æ–‡ä»¶è¿›è¡ŒåŠ å·¥ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹åˆ¶ä½œã€‚

ä¸ºäº†æ–¹ä¾¿å…±äº«ï¼Œimage æ–‡ä»¶åˆ¶ä½œå®Œæˆåï¼Œå¯ä»¥ä¸Šä¼ åˆ°ç½‘ä¸Šçš„ä»“åº“ã€‚Docker çš„å®˜æ–¹ä»“åº“Â [Docker Hub](https://hub.docker.com/)Â æ˜¯æœ€é‡è¦ã€æœ€å¸¸ç”¨çš„ image ä»“åº“ã€‚æ­¤å¤–ï¼Œå‡ºå”®è‡ªå·±åˆ¶ä½œçš„ image æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

## å…«ã€å®¹å™¨æ–‡ä»¶

**image æ–‡ä»¶ç”Ÿæˆçš„å®¹å™¨å®ä¾‹ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç§°ä¸ºå®¹å™¨æ–‡ä»¶ã€‚** ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦å®¹å™¨ç”Ÿæˆï¼Œå°±ä¼šåŒæ—¶å­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ï¼š image æ–‡ä»¶å’Œå®¹å™¨æ–‡ä»¶ã€‚è€Œä¸”å…³é—­å®¹å™¨å¹¶ä¸ä¼šåˆ é™¤å®¹å™¨æ–‡ä»¶ï¼Œåªæ˜¯å®¹å™¨åœæ­¢è¿è¡Œè€Œå·²ã€‚

```bash
# åˆ—å‡ºæœ¬æœºæ­£åœ¨è¿è¡Œçš„å®¹å™¨
$ docker container ls
# åˆ—å‡ºæœ¬æœºæ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬ç»ˆæ­¢è¿è¡Œçš„å®¹å™¨
$ docker container ls --all
```

ä¸Šé¢å‘½ä»¤çš„è¾“å‡ºç»“æœä¹‹ä¸­ï¼ŒåŒ…æ‹¬å®¹å™¨çš„ IDã€‚å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦æä¾›è¿™ä¸ª IDï¼Œæ¯”å¦‚ä¸Šä¸€èŠ‚ç»ˆæ­¢å®¹å™¨è¿è¡Œçš„`docker container kill`å‘½ä»¤ã€‚

ç»ˆæ­¢è¿è¡Œçš„å®¹å™¨æ–‡ä»¶ï¼Œä¾ç„¶ä¼šå æ®ç¡¬ç›˜ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨[`docker container rm`](https://docs.docker.com/engine/reference/commandline/container_rm/)å‘½ä»¤åˆ é™¤ã€‚

```bash
$ docker container rm [containerID]
```

è¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¹‹åï¼Œå†ä½¿ç”¨`docker container ls --all`å‘½ä»¤ï¼Œå°±ä¼šå‘ç°è¢«åˆ é™¤çš„å®¹å™¨æ–‡ä»¶å·²ç»æ¶ˆå¤±äº†ã€‚

## ä¹ã€å®ä¾‹ï¼šhello world

ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡æœ€ç®€å•çš„ image æ–‡ä»¶"[hello world"](https://hub.docker.com/r/library/hello-world/)ï¼Œæ„Ÿå—ä¸€ä¸‹ Dockerã€‚

éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå›½å†…è¿æ¥ Docker çš„å®˜æ–¹ä»“åº“å¾ˆæ…¢ï¼Œè¿˜ä¼šæ–­çº¿ï¼Œéœ€è¦å°†é»˜è®¤ä»“åº“æ”¹æˆå›½å†…çš„é•œåƒç½‘ç«™ï¼Œå…·ä½“çš„ä¿®æ”¹æ–¹æ³•åœ¨[ä¸‹ä¸€ç¯‡æ–‡ç« ](http://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html)çš„ç¬¬ä¸€èŠ‚ã€‚æœ‰éœ€è¦çš„æœ‹å‹ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ã€‚

é¦–å…ˆï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°† image æ–‡ä»¶ä»ä»“åº“æŠ“å–åˆ°æœ¬åœ°ã€‚

```bash 
$ docker image pull library/hello-world
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`docker image pull`æ˜¯æŠ“å– image æ–‡ä»¶çš„å‘½ä»¤ã€‚`library/hello-world`æ˜¯ image æ–‡ä»¶åœ¨ä»“åº“é‡Œé¢çš„ä½ç½®ï¼Œå…¶ä¸­`library`æ˜¯ image æ–‡ä»¶æ‰€åœ¨çš„ç»„ï¼Œ`hello-world`æ˜¯ image æ–‡ä»¶çš„åå­—ã€‚

ç”±äº Docker å®˜æ–¹æä¾›çš„ image æ–‡ä»¶ï¼Œéƒ½æ”¾åœ¨[`library`](https://hub.docker.com/r/library/)ç»„é‡Œé¢ï¼Œæ‰€ä»¥å®ƒçš„æ˜¯é»˜è®¤ç»„ï¼Œå¯ä»¥çœç•¥ã€‚å› æ­¤ï¼Œä¸Šé¢çš„å‘½ä»¤å¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚

```bash
$ docker image pull hello-world
# æŠ“å–æˆåŠŸä»¥åï¼Œå°±å¯ä»¥åœ¨æœ¬æœºçœ‹åˆ°è¿™ä¸ª image æ–‡ä»¶äº†
$ docker image ls
# ç°åœ¨ï¼Œè¿è¡Œè¿™ä¸ª image æ–‡ä»¶
$ docker container run hello-world
```

`docker container run` å‘½ä»¤ä¼šä» image æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨å®ä¾‹ã€‚

æ³¨æ„ï¼Œ`docker container run` å‘½ä»¤å…·æœ‰è‡ªåŠ¨æŠ“å– image æ–‡ä»¶çš„åŠŸèƒ½ã€‚å¦‚æœå‘ç°æœ¬åœ°æ²¡æœ‰æŒ‡å®šçš„ image æ–‡ä»¶ï¼Œå°±ä¼šä»ä»“åº“è‡ªåŠ¨æŠ“å–ã€‚å› æ­¤ï¼Œå‰é¢çš„`docker image pull`å‘½ä»¤å¹¶ä¸æ˜¯å¿…éœ€çš„æ­¥éª¤ã€‚

å¦‚æœè¿è¡ŒæˆåŠŸï¼Œä½ ä¼šåœ¨å±å¹•ä¸Šè¯»åˆ°ä¸‹é¢çš„è¾“å‡ºã€‚

```bash
$ docker container run hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.
```

è¾“å‡ºè¿™æ®µæç¤ºä»¥åï¼Œ`hello world` å°±ä¼šåœæ­¢è¿è¡Œï¼Œå®¹å™¨è‡ªåŠ¨ç»ˆæ­¢ã€‚

æœ‰äº›å®¹å™¨ä¸ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œå› ä¸ºæä¾›çš„æ˜¯æœåŠ¡ã€‚æ¯”å¦‚ï¼Œå®‰è£…è¿è¡Œ Ubuntu çš„ imageï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä½“éªŒ Ubuntu ç³»ç»Ÿã€‚

```bash
$ docker container run -it ubuntu bash
```

å¯¹äºé‚£äº›ä¸ä¼šè‡ªåŠ¨ç»ˆæ­¢çš„å®¹å™¨ï¼Œå¿…é¡»ä½¿ç”¨[`docker container kill`](https://docs.docker.com/engine/reference/commandline/container_kill/)Â å‘½ä»¤æ‰‹åŠ¨ç»ˆæ­¢ã€‚

```bash
$ docker container kill [containID]
```

## åã€Dockerfile æ–‡ä»¶

å­¦ä¼šä½¿ç”¨ image æ–‡ä»¶ä»¥åï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•å¯ä»¥ç”Ÿæˆ image æ–‡ä»¶ï¼Ÿå¦‚æœä½ è¦æ¨å¹¿è‡ªå·±çš„è½¯ä»¶ï¼ŒåŠ¿å¿…è¦è‡ªå·±åˆ¶ä½œ image æ–‡ä»¶ã€‚

è¿™å°±éœ€è¦ç”¨åˆ° Dockerfile æ–‡ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç”¨æ¥é…ç½® imageã€‚Docker æ ¹æ® è¯¥æ–‡ä»¶ç”ŸæˆäºŒè¿›åˆ¶çš„ image æ–‡ä»¶ã€‚

ä¸‹é¢é€šè¿‡ä¸€ä¸ªå®ä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ç¼–å†™ Dockerfile æ–‡ä»¶ã€‚

## åä¸€ã€å®ä¾‹ï¼šåˆ¶ä½œè‡ªå·±çš„ Docker å®¹å™¨

ä¸‹é¢æˆ‘ä»¥Â [koa-demos](http://www.ruanyifeng.com/blog/2017/08/koa.html)Â é¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»æ€ä¹ˆå†™ Dockerfile æ–‡ä»¶ï¼Œå®ç°è®©ç”¨æˆ·åœ¨ Docker å®¹å™¨é‡Œé¢è¿è¡Œ Koa æ¡†æ¶ã€‚

ä½œä¸ºå‡†å¤‡å·¥ä½œï¼Œè¯·å…ˆ[ä¸‹è½½æºç ](https://github.com/ruanyf/koa-demos/archive/master.zip)ã€‚

```bash
$ git clone https://github.com/ruanyf/koa-demos.git
$ cd koa-demos
```

### 11.1 ç¼–å†™ Dockerfile æ–‡ä»¶

é¦–å…ˆï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶`.dockerignore`ï¼Œå†™å…¥ä¸‹é¢çš„[å†…å®¹](https://github.com/ruanyf/koa-demos/blob/master/.dockerignore)ã€‚

```bash
.git
node_modules
npm-debug.log
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œè¿™ä¸‰ä¸ªè·¯å¾„è¦æ’é™¤ï¼Œä¸è¦æ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ã€‚å¦‚æœä½ æ²¡æœ‰è·¯å¾„è¦æ’é™¤ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ä¸æ–°å»ºã€‚

ç„¶åï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ Dockerfileï¼Œå†™å…¥ä¸‹é¢çš„[å†…å®¹](https://github.com/ruanyf/koa-demos/blob/master/Dockerfile)ã€‚

```bash
FROM node:8.4
COPY . /app
WORKDIR /app
RUN npm install --registry=https://registry.npm.taobao.org
EXPOSE 3000
```

ä¸Šé¢ä»£ç ä¸€å…±äº”è¡Œï¼Œå«ä¹‰å¦‚ä¸‹ã€‚

 - `FROM node:8.4`ï¼šè¯¥ image æ–‡ä»¶ç»§æ‰¿å®˜æ–¹çš„ node imageï¼Œå†’å·è¡¨ç¤ºæ ‡ç­¾ï¼Œè¿™é‡Œæ ‡ç­¾æ˜¯`8.4`ï¼Œå³8.4ç‰ˆæœ¬çš„ nodeã€‚
- `COPY . /app`ï¼šå°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆé™¤äº†`.dockerignore`æ’é™¤çš„è·¯å¾„ï¼‰ï¼Œéƒ½æ‹·è´è¿›å…¥ image æ–‡ä»¶çš„`/app`ç›®å½•ã€‚
- `WORKDIR /app`ï¼šæŒ‡å®šæ¥ä¸‹æ¥çš„å·¥ä½œè·¯å¾„ä¸º`/app`ã€‚
- `RUN npm install`ï¼šåœ¨`/app`ç›®å½•ä¸‹ï¼Œè¿è¡Œ`npm install`å‘½ä»¤å®‰è£…ä¾èµ–ã€‚æ³¨æ„ï¼Œå®‰è£…åæ‰€æœ‰çš„ä¾èµ–ï¼Œéƒ½å°†æ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ã€‚
- `EXPOSE 3000`ï¼šå°†å®¹å™¨ 3000 ç«¯å£æš´éœ²å‡ºæ¥ï¼Œ å…è®¸å¤–éƒ¨è¿æ¥è¿™ä¸ªç«¯å£ã€‚

### 11.2 åˆ›å»º image æ–‡ä»¶

æœ‰äº† Dockerfile æ–‡ä»¶ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨`docker image build`å‘½ä»¤åˆ›å»º image æ–‡ä»¶äº†ã€‚

```bash
$ docker image build -t koa-demo .
# æˆ–è€…
$ docker image build -t koa-demo:0.0.1 .
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`-t`å‚æ•°ç”¨æ¥æŒ‡å®š image æ–‡ä»¶çš„åå­—ï¼Œåé¢è¿˜å¯ä»¥ç”¨å†’å·æŒ‡å®šæ ‡ç­¾ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤çš„æ ‡ç­¾å°±æ˜¯`latest`ã€‚æœ€åçš„é‚£ä¸ªç‚¹è¡¨ç¤º Dockerfile æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œä¸Šä¾‹æ˜¯å½“å‰è·¯å¾„ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªç‚¹ã€‚

å¦‚æœè¿è¡ŒæˆåŠŸï¼Œå°±å¯ä»¥çœ‹åˆ°æ–°ç”Ÿæˆçš„ image æ–‡ä»¶`koa-demo`äº†ã€‚

```bash
$ docker image ls
```

### 11.3 ç”Ÿæˆå®¹å™¨

`docker container run`å‘½ä»¤ä¼šä» image æ–‡ä»¶ç”Ÿæˆå®¹å™¨ã€‚

```bash
$ docker container run -p 8000:3000 -it koa-demo /bin/bash
# æˆ–è€…
$ docker container run -p 8000:3000 -it koa-demo:0.0.1 /bin/bash
```

ä¸Šé¢å‘½ä»¤çš„å„ä¸ªå‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š

- `-p`å‚æ•°ï¼šå®¹å™¨çš„ 3000 ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„ 8000 ç«¯å£ã€‚
- `-it`å‚æ•°ï¼šå®¹å™¨çš„ Shell æ˜ å°„åˆ°å½“å‰çš„ Shellï¼Œç„¶åä½ åœ¨æœ¬æœºçª—å£è¾“å…¥çš„å‘½ä»¤ï¼Œå°±ä¼šä¼ å…¥å®¹å™¨ã€‚
- `koa-demo:0.0.1`ï¼šimage æ–‡ä»¶çš„åå­—ï¼ˆå¦‚æœæœ‰æ ‡ç­¾ï¼Œè¿˜éœ€è¦æä¾›æ ‡ç­¾ï¼Œé»˜è®¤æ˜¯ latest æ ‡ç­¾ï¼‰ã€‚
- `/bin/bash`ï¼šå®¹å™¨å¯åŠ¨ä»¥åï¼Œå†…éƒ¨ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œæ˜¯å¯åŠ¨ Bashï¼Œä¿è¯ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Shellã€‚

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¿è¡Œä¸Šé¢çš„å‘½ä»¤ä»¥åï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªå‘½ä»¤è¡Œæç¤ºç¬¦ã€‚

```bash
root@66d80f4aaf1e:/app#
```

è¿™è¡¨ç¤ºä½ å·²ç»åœ¨å®¹å™¨é‡Œé¢äº†ï¼Œè¿”å›çš„æç¤ºç¬¦å°±æ˜¯å®¹å™¨å†…éƒ¨çš„ Shell æç¤ºç¬¦ã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚

```bash
root@66d80f4aaf1e:/app# node demos/01.js
```

è¿™æ—¶ï¼ŒKoa æ¡†æ¶å·²ç»è¿è¡Œèµ·æ¥äº†ã€‚æ‰“å¼€æœ¬æœºçš„æµè§ˆå™¨ï¼Œè®¿é—® `http://127.0.0.1:8000ï¼Œç½‘é¡µæ˜¾ç¤º "Not Found"`ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªÂ [demo](https://github.com/ruanyf/koa-demos/blob/master/demos/01.js)Â æ²¡æœ‰å†™è·¯ç”±ã€‚

è¿™ä¸ªä¾‹å­ä¸­ï¼ŒNode è¿›ç¨‹è¿è¡Œåœ¨ Docker å®¹å™¨çš„è™šæ‹Ÿç¯å¢ƒé‡Œé¢ï¼Œè¿›ç¨‹æ¥è§¦åˆ°çš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œæ¥å£éƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œä¸æœ¬æœºçš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œæ¥å£æ˜¯éš”ç¦»çš„ï¼Œå› æ­¤éœ€è¦å®šä¹‰å®¹å™¨ä¸ç‰©ç†æœºçš„ç«¯å£æ˜ å°„ï¼ˆmapï¼‰ã€‚

ç°åœ¨ï¼Œåœ¨å®¹å™¨çš„å‘½ä»¤è¡Œï¼ŒæŒ‰ä¸‹ Ctrl + c åœæ­¢ Node è¿›ç¨‹ï¼Œç„¶åæŒ‰ä¸‹ Ctrl + d ï¼ˆæˆ–è€…è¾“å…¥ exitï¼‰é€€å‡ºå®¹å™¨ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨`docker container kill`ç»ˆæ­¢å®¹å™¨è¿è¡Œã€‚

```bash
# åœ¨æœ¬æœºçš„å¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼ŒæŸ¥å‡ºå®¹å™¨çš„ ID
$ docker container ls
# åœæ­¢æŒ‡å®šçš„å®¹å™¨è¿è¡Œ
$ docker container kill [containerID]
```

å®¹å™¨åœæ­¢è¿è¡Œä¹‹åï¼Œå¹¶ä¸ä¼šæ¶ˆå¤±ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤åˆ é™¤å®¹å™¨æ–‡ä»¶ã€‚

```bash
# æŸ¥å‡ºå®¹å™¨çš„ ID
$ docker container ls --all
# åˆ é™¤æŒ‡å®šçš„å®¹å™¨æ–‡ä»¶
$ docker container rm [containerID]
```

ä¹Ÿå¯ä»¥ä½¿ç”¨`docker container run`å‘½ä»¤çš„`--rm`å‚æ•°ï¼Œåœ¨å®¹å™¨ç»ˆæ­¢è¿è¡Œåè‡ªåŠ¨åˆ é™¤å®¹å™¨æ–‡ä»¶ã€‚

```bash 
$ docker container run --rm -p 8000:3000 -it koa-demo /bin/bash
```

### 11.4 CMD å‘½ä»¤

ä¸Šä¸€èŠ‚çš„ä¾‹å­é‡Œé¢ï¼Œå®¹å™¨å¯åŠ¨ä»¥åï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥å‘½ä»¤`node demos/01.js`ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤å†™åœ¨ Dockerfile é‡Œé¢ï¼Œè¿™æ ·å®¹å™¨å¯åŠ¨ä»¥åï¼Œè¿™ä¸ªå‘½ä»¤å°±å·²ç»æ‰§è¡Œäº†ï¼Œä¸ç”¨å†æ‰‹åŠ¨è¾“å…¥äº†ã€‚

```bash 
FROM node:8.4
COPY . /app
WORKDIR /app
RUN npm install --registry=https://registry.npm.taobao.org
EXPOSE 3000
CMD node demos/01.js
```

ä¸Šé¢çš„ Dockerfile é‡Œé¢ï¼Œå¤šäº†æœ€åä¸€è¡Œ`CMD node demos/01.js`ï¼Œå®ƒè¡¨ç¤ºå®¹å™¨å¯åŠ¨åè‡ªåŠ¨æ‰§è¡Œ`node demos/01.js`ã€‚

ä½ å¯èƒ½ä¼šé—®ï¼Œ`RUN`å‘½ä»¤ä¸`CMD`å‘½ä»¤çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿç®€å•è¯´ï¼Œ`RUN`å‘½ä»¤åœ¨ image æ–‡ä»¶çš„æ„å»ºé˜¶æ®µæ‰§è¡Œï¼Œæ‰§è¡Œç»“æœéƒ½ä¼šæ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ï¼›`CMD`å‘½ä»¤åˆ™æ˜¯åœ¨å®¹å™¨å¯åŠ¨åæ‰§è¡Œã€‚å¦å¤–ï¼Œä¸€ä¸ª Dockerfile å¯ä»¥åŒ…å«å¤šä¸ª`RUN`å‘½ä»¤ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ª`CMD`å‘½ä»¤ã€‚

æ³¨æ„ï¼ŒæŒ‡å®šäº†`CMD`å‘½ä»¤ä»¥åï¼Œ`docker container run`å‘½ä»¤å°±ä¸èƒ½é™„åŠ å‘½ä»¤äº†ï¼ˆæ¯”å¦‚å‰é¢çš„`/bin/bash`ï¼‰ï¼Œå¦åˆ™å®ƒä¼šè¦†ç›–`CMD`å‘½ä»¤ã€‚ç°åœ¨ï¼Œå¯åŠ¨å®¹å™¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚

```bash 
$ docker container run --rm -p 8000:3000 -it koa-demo:0.0.1
```

### 11.5 å‘å¸ƒ image æ–‡ä»¶

å®¹å™¨è¿è¡ŒæˆåŠŸåï¼Œå°±ç¡®è®¤äº† image æ–‡ä»¶çš„æœ‰æ•ˆæ€§ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘æŠŠ image æ–‡ä»¶åˆ†äº«åˆ°ç½‘ä¸Šï¼Œè®©å…¶ä»–äººä½¿ç”¨ã€‚

é¦–å…ˆï¼Œå»Â [hub.docker.com](https://hub.docker.com/)Â æˆ–Â [cloud.docker.com](https://cloud.docker.com/)Â æ³¨å†Œä¸€ä¸ªè´¦æˆ·ã€‚ç„¶åï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤ç™»å½•ã€‚

```bash
$ docker login
```

æ¥ç€ï¼Œä¸ºæœ¬åœ°çš„ image æ ‡æ³¨ç”¨æˆ·åå’Œç‰ˆæœ¬ã€‚

```bash
$ docker image tag [imageName] [username]/[repository]:[tag]
# å®ä¾‹
$ docker image tag koa-demos:0.0.1 ruanyf/koa-demos:0.0.1
```

ä¹Ÿå¯ä»¥ä¸æ ‡æ³¨ç”¨æˆ·åï¼Œé‡æ–°æ„å»ºä¸€ä¸‹ image æ–‡ä»¶ã€‚

```bash 
$ docker image build -t [username]/[repository]:[tag] .
```

æœ€åï¼Œå‘å¸ƒ image æ–‡ä»¶ã€‚

```bash
$ docker image push [username]/[repository]:[tag]
```

å‘å¸ƒæˆåŠŸä»¥åï¼Œç™»å½• hub.docker.comï¼Œå°±å¯ä»¥çœ‹åˆ°å·²ç»å‘å¸ƒçš„ image æ–‡ä»¶ã€‚

## åäºŒã€å…¶ä»–æœ‰ç”¨çš„å‘½ä»¤

docker çš„ä¸»è¦ç”¨æ³•å°±æ˜¯ä¸Šé¢è¿™äº›ï¼Œæ­¤å¤–è¿˜æœ‰å‡ ä¸ªå‘½ä»¤ï¼Œä¹Ÿéå¸¸æœ‰ç”¨ã€‚

**ï¼ˆ1ï¼‰docker container start**

å‰é¢çš„`docker container run`å‘½ä»¤æ˜¯æ–°å»ºå®¹å™¨ï¼Œæ¯è¿è¡Œä¸€æ¬¡ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ªå®¹å™¨ã€‚åŒæ ·çš„å‘½ä»¤è¿è¡Œä¸¤æ¬¡ï¼Œå°±ä¼šç”Ÿæˆä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„å®¹å™¨æ–‡ä»¶ã€‚å¦‚æœå¸Œæœ›é‡å¤ä½¿ç”¨å®¹å™¨ï¼Œå°±è¦ä½¿ç”¨`docker container start`å‘½ä»¤ï¼Œå®ƒç”¨æ¥å¯åŠ¨å·²ç»ç”Ÿæˆã€å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨æ–‡ä»¶ã€‚

```bash 
$ docker container start [containerID]
```

**ï¼ˆ2ï¼‰docker container stop**

å‰é¢çš„`docker container kill`å‘½ä»¤ç»ˆæ­¢å®¹å™¨è¿è¡Œï¼Œç›¸å½“äºå‘å®¹å™¨é‡Œé¢çš„ä¸»è¿›ç¨‹å‘å‡º SIGKILL ä¿¡å·ã€‚è€Œ`docker container stop`å‘½ä»¤ä¹Ÿæ˜¯ç”¨æ¥ç»ˆæ­¢å®¹å™¨è¿è¡Œï¼Œç›¸å½“äºå‘å®¹å™¨é‡Œé¢çš„ä¸»è¿›ç¨‹å‘å‡º SIGTERM ä¿¡å·ï¼Œç„¶åè¿‡ä¸€æ®µæ—¶é—´å†å‘å‡º SIGKILL ä¿¡å·ã€‚

```bash
$ docker container stop [containerID]
```

è¿™ä¸¤ä¸ªä¿¡å·çš„å·®åˆ«æ˜¯ï¼Œåº”ç”¨ç¨‹åºæ”¶åˆ° SIGTERM ä¿¡å·ä»¥åï¼Œå¯ä»¥è‡ªè¡Œè¿›è¡Œæ”¶å°¾æ¸…ç†å·¥ä½œï¼Œä½†ä¹Ÿå¯ä»¥ä¸ç†ä¼šè¿™ä¸ªä¿¡å·ã€‚å¦‚æœæ”¶åˆ° SIGKILL ä¿¡å·ï¼Œå°±ä¼šå¼ºè¡Œç«‹å³ç»ˆæ­¢ï¼Œé‚£äº›æ­£åœ¨è¿›è¡Œä¸­çš„æ“ä½œä¼šå…¨éƒ¨ä¸¢å¤±ã€‚

**ï¼ˆ3ï¼‰docker container logs**

`docker container logs`å‘½ä»¤ç”¨æ¥æŸ¥çœ‹ docker å®¹å™¨çš„è¾“å‡ºï¼Œå³å®¹å™¨é‡Œé¢ Shell çš„æ ‡å‡†è¾“å‡ºã€‚å¦‚æœ`docker run`å‘½ä»¤è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œæ²¡æœ‰ä½¿ç”¨`-it`å‚æ•°ï¼Œå°±è¦ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹è¾“å‡ºã€‚

```bash
$ docker container logs [containerID]
```

**ï¼ˆ4ï¼‰docker container exec**

`docker container exec`å‘½ä»¤ç”¨äºè¿›å…¥ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ docker å®¹å™¨ã€‚å¦‚æœ`docker run`å‘½ä»¤è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œæ²¡æœ‰ä½¿ç”¨`-it`å‚æ•°ï¼Œå°±è¦ç”¨è¿™ä¸ªå‘½ä»¤è¿›å…¥å®¹å™¨ã€‚ä¸€æ—¦è¿›å…¥äº†å®¹å™¨ï¼Œå°±å¯ä»¥åœ¨å®¹å™¨çš„ Shell æ‰§è¡Œå‘½ä»¤äº†ã€‚

```bash
$ docker container exec -it [containerID] /bin/bash
```

**ï¼ˆ5ï¼‰docker container cp**

`docker container cp`å‘½ä»¤ç”¨äºä»æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨é‡Œé¢ï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°æœ¬æœºã€‚ä¸‹é¢æ˜¯æ‹·è´åˆ°å½“å‰ç›®å½•çš„å†™æ³•ã€‚

```bash
$ docker container cp [containID]:[/path/to/file] .
```

[ä¸‹ä¸€ç¯‡ğŸ˜„](Docker%20å¾®æœåŠ¡æ•™ç¨‹.md)ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ Docker æ­å»ºçœŸæ­£çš„ç½‘ç«™ã€‚
